# Bundling in Nui

Nui uses [parcel](https://parceljs.org/) under the hood to bundle everything together.
The regular cases try to inline everything and place them in a single index.html, sometimes this approach is not 
possible or desireable.

## Status Quo in the Template

The template provides the followin index.html file.
In this index.html file, sources and styles are inlined by parcel by
using the import statements instead of adding every file by using script tags.

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nui</title>

    <!-- highlight-start -->
    <!-- You have to import like this to achieve inlining of the style -->
    <style>
        @import "./styles/main.css";
    </style>
    <!-- highlight-end -->

    <!-- highlight-start -->
    <!-- You have to import like this to achieve inlining of the script -->
    <script type="module" defer>
        import "./source/index.js";
        import "../bin/index.js";
    </script>
    <!-- highlight-end -->
</head>
<body>
</body>
```

This will produce as single index.html located at `*/build/module-TARGETNAME/bin/index.html`
which is then automtically accessible from the backend source by including it:

```cpp
// highlight-start
// This file is generated by nui.
#include <index.hpp>
// highlight-end

int main() {
    using namespace Nui;

    Window window{"Window Title", true /* may open debug window */};

    // highlight-start
    // index function to be used here:
    window.setHtml(index());
    // highlight-end
}
```

## Inline

### Image assets
Images can be inlined in the CSS using:
```css
.foo {
  background: url(data-url:./background.png);
}
```

### Typescript/Javascript Code
Just import regularly from your source files:
```javascript
import _ from "lodash";
```
Or from index.html:
```html
<script type="module" defer>
    import "./source/bla.js";
</script>
```

## External
Sometimes you dont want to bundle because resources would become to big for a big bundled index blob.

### Images
Currently 2 different ways of file mappings enabled via `Window::setVirtualHostNameToFolderMapping` are needed.
setVirtualHostNameToFolderMapping maps a host name under the assets:// scheme (https: on windows) to a folder.
This may change in the future, when schema mappings are implemented for windows, unifying to the linux way of 
referencing files:
```css
.remove-button-win{
    background-image: url("https://assets/red_cross.svg");
}
.remove-button-nix {
    background-image: url("assets://assets/red_cross.svg");
}
```

### Typescript/Javascript Code
Import using the url prefix to avoid inlining:
```javascript
import EditorWorker from 'url:monaco-editor/esm/vs/editor/editor.worker.js';
```
TODO: get more into detail.


